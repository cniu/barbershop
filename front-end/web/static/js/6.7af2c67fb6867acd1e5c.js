webpackJsonp([6],{UAna:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("woOf"),l=s.n(a),n={name:"FellowList",components:{FellowItem:s("wm/4").a},data:function(){var e=this;return{employee_list:[],card_type_list:[],singleItem:{},modal_type:"modify",modal_title:"",singleModal:!1,search:"",page:1,page_size:20,total_count:0,order:"desc",order_key:"created_time",fellow_list_data:[],columns:[{title:"编号",key:"raw_id",width:80},{title:"姓名",key:"name",sortable:"custom"},{title:"手机号",key:"phone_number",sortable:"custom"},{title:"生日",key:"birthday",sortable:"custom",render:function(e,t){if(""!=t.row.birthday)return e("div",new Date(t.row.birthday).toLocaleDateString())}},{title:"会员卡类型",key:"card_type",sortable:"custom"},{title:"余额",key:"money",sortable:"custom"},{title:"开卡人",key:"created_by",sortable:"custom"},{title:"更新时间",key:"created_time",sortable:"custom"},{title:"Action",key:"action",width:150,align:"center",render:function(t,s){return t("div",[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.modifyItem(s.index)}}},"编辑"),t("Button",{props:{type:"error",size:"small"},on:{click:function(){e.removeItem(s.index)}}},"删除")])}}]}},computed:{},watch:{},created:function(){this.getFellowLists(),this.getCardTypeList(),this.getEmployees()},methods:{getFellowLists:function(){var e=this,t="/fellows?";t+="page="+this.page,t+="&page_size="+this.page_size,t+="&order="+this.order,t+="&order_key="+this.order_key,this.$http.post(t,{search:this.search}).then(function(t){var s=t.data;e.fellow_list_data=s.data,e.total_count=s.total_count,e.page=s.page,"success"!=s.status&&e.$Message.error(s.message)},function(t){401==t.status&&e.$router.push({name:"login"})})},getCardTypeList:function(){var e=this;this.$http.get("/summarized_setting").then(function(t){var s=t.data;e.card_type_list=s.card_type_list,"success"!=s.status&&e.$Message.error(s.message)},function(t){401==t.status&&e.$router.push({name:"login"})})},getEmployees:function(){var e=this;this.$http.get("/summarized_employees").then(function(t){var s=t.data;e.employee_list=s.employee_list,"success"!=s.status&&e.$Message.error(s.message)},function(t){401==t.status&&e.$router.push({name:"login"})})},handleSearch:function(e){this.search=e,this.getFellowLists()},modifyItem:function(e){this.singleModal=!0,this.modal_type="modify",this.modal_title="修改会员信息",this.singleItem=l()({},this.fellow_list_data[e]),""!=this.singleItem.birthday&&(this.singleItem.birthday=new Date(this.singleItem.birthday))},changePage:function(e){this.page=e,this.getFellowLists()},changePageSize:function(e){this.page_size=e,this.getFellowLists()},sortChange:function(e){this.order=e.order,this.order_key=e.key,this.getFellowLists()},visibleChange:function(e){this.singleModal=e},closeModal:function(e){this.singleModal=!1,this.getFellowLists()},removeItem:function(e){var t=this;this.$Modal.confirm({title:"是否确认删除",content:"",onOk:function(){var s="/fellow/"+t.fellow_list_data[e].phone_number;t.$http.delete(s).then(function(e){var s=e.data;"success"!=s.status?t.$Message.error(s.message):(t.$Message.success("删除成功!"),t.getFellowLists())},function(e){401==e.status&&t.$router.push({name:"login"})})},onCancel:function(){}})},addItem:function(){this.modal_type="add",this.modal_title="开卡",this.singleItem={},this.singleModal=!0,this.getFellowLists()}}},i={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("Row",{staticClass:"code-row-bg",staticStyle:{padding:"10px"},attrs:{type:"flex",justify:"end"}},[s("Col",{attrs:{span:"4"}},[s("Button",{attrs:{type:"primary",shape:"circle"},on:{click:e.addItem}},[e._v("添加")])],1),e._v(" "),s("Col",{attrs:{span:"8",offset:"12"}},[s("Input",{staticStyle:{width:"300px",float:"right"},attrs:{search:"","enter-button":"",placeholder:"请输入关键字搜索"},on:{"on-search":e.handleSearch},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)],1),e._v(" "),s("Row",{staticClass:"code-row-bg",staticStyle:{padding:"10px"},attrs:{type:"flex",justify:"start"}},[s("Col",{attrs:{span:"24"}},[s("Table",{attrs:{border:"",columns:e.columns,data:e.fellow_list_data},on:{"on-sort-change":e.sortChange}})],1)],1),e._v(" "),s("Row",{staticClass:"code-row-bg",staticStyle:{padding:"10px"},attrs:{type:"flex",justify:"end"}},[s("Col",{attrs:{span:"24"}},[s("Page",{staticStyle:{float:"right"},attrs:{total:e.total_count,"show-total":"","show-sizer":"",current:e.page,"page-size":e.page_size,"page-size-opts":[20,50,100,500]},on:{"on-change":e.changePage,"on-page-size-change":e.changePageSize}})],1)],1),e._v(" "),s("Modal",{attrs:{"footer-hide":"",title:e.modal_title},on:{"on-visible-change":e.visibleChange},model:{value:e.singleModal,callback:function(t){e.singleModal=t},expression:"singleModal"}},[s("FellowItem",{attrs:{singleItem:e.singleItem,modal_type:e.modal_type,card_type_list:e.card_type_list,employee_list:e.employee_list},on:{closeModal:e.closeModal}})],1)],1)},staticRenderFns:[]},o=s("VU/8")(n,i,!1,null,null,null).exports;t.default=o},"wm/4":function(e,t,s){"use strict";var a=s("woOf"),l=s.n(a),n={name:"SellItem",props:{modal_type:"",card_type_list:"",employee_list:"",singleItem:{name:"",phone_number:"",birthday:"",card_type:"",money:0,created_by:"",password:"",item_number:""}},data:function(){return{ruleValidate:{name:[{required:!0,message:"请输入名称",trigger:"blur"}],phone_number:[{required:!0,message:"请输入电话号码"},{type:"number",message:"错误格式"}],birthday:[{required:!1,message:"请选择日期"}],card_type:[{required:!0,message:"请选择卡类型"}],money:[{required:!0,message:"请填写金额"},{type:"number",message:"错误金额"}],created_by:[{required:!0,message:"请选择开卡人"}]}}},methods:{handleSubmit:function(e){var t=this;this.$refs[e].validate(function(s){if(s){if("modify"==t.$props.modal_type){var a="/fellow/"+t.singleItem.phone_number;(n=l()({},t.singleItem)).birthday=n.birthday.toString(),t.$http.put(a,n).then(function(s){var a=s.data;"success"!=a.status?t.$Message.error(a.message):(t.$Message.success("修改成功!"),t.$emit("closeModal","submit"),t.$refs[e].resetFields())},function(e){401==e.status&&t.$router.push({name:"login"})})}else if("add"==t.$props.modal_type){var n;a="/fellow/1";(n=l()({},t.singleItem)).birthday="birthday"in n?n.birthday.toString():"",t.$http.post(a,n).then(function(s){var l=s.data;"success"!=l.status?t.$Message.error(l.message):(a="/handle_flow/add_fellow",t.$http.post(a,n).then(function(e){var s=e.data;"success"!=s.status&&t.$Message.error(s.message)},function(e){}),t.$Message.success("新增成功!"),t.$emit("closeModal","submit"),t.$refs[e].resetFields())},function(e){401==e.status&&t.$router.push({name:"login"})})}}else t.$Message.error("请查看是否填写完必须输入的项!")})},handleReset:function(e){this.$refs[e].resetFields()}}},i={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Row",[s("Form",{ref:"singleItem",attrs:{model:e.singleItem,rules:e.ruleValidate,"label-width":80}},[s("FormItem",{staticStyle:{display:"none"},attrs:{label:"单号",prop:"item"}},[s("Input",{attrs:{disabled:""},model:{value:e.singleItem.item_number,callback:function(t){e.$set(e.singleItem,"item_number",t)},expression:"singleItem.item_number"}})],1),e._v(" "),s("FormItem",{attrs:{label:"姓名",prop:"name"}},[s("Input",{attrs:{placeholder:"请输入姓名"},model:{value:e.singleItem.name,callback:function(t){e.$set(e.singleItem,"name",t)},expression:"singleItem.name"}})],1),e._v(" "),s("FormItem",{attrs:{label:"手机号",prop:"phone_number"}},["add"!=e.modal_type?s("InputNumber",{staticStyle:{width:"280px"},attrs:{disabled:"",placeholder:"请输入手机号"},model:{value:e.singleItem.phone_number,callback:function(t){e.$set(e.singleItem,"phone_number",t)},expression:"singleItem.phone_number"}}):e._e(),e._v(" "),"add"==e.modal_type?s("InputNumber",{staticStyle:{width:"280px"},attrs:{placeholder:"请输入手机号"},model:{value:e.singleItem.phone_number,callback:function(t){e.$set(e.singleItem,"phone_number",t)},expression:"singleItem.phone_number"}}):e._e()],1),e._v(" "),s("FormItem",{attrs:{label:"消费密码",prop:"password"}},[s("Input",{attrs:{type:"password",placeholder:"请设置消费密码"},model:{value:e.singleItem.password,callback:function(t){e.$set(e.singleItem,"password",t)},expression:"singleItem.password"}})],1),e._v(" "),s("FormItem",{attrs:{label:"生日",prop:"birthday"}},[s("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"date",placeholder:"Select date"},model:{value:e.singleItem.birthday,callback:function(t){e.$set(e.singleItem,"birthday",t)},expression:"singleItem.birthday"}})],1),e._v(" "),s("FormItem",{attrs:{label:"卡类型",prop:"card_type"}},[s("Select",{attrs:{placeholder:"请选择会员卡类型"},model:{value:e.singleItem.card_type,callback:function(t){e.$set(e.singleItem,"card_type",t)},expression:"singleItem.card_type"}},e._l(e.card_type_list,function(t,a){return s("Option",{key:a,attrs:{value:t.value}},[e._v(e._s(t.label))])}))],1),e._v(" "),s("FormItem",{attrs:{label:"余额",prop:"money"}},["add"==e.modal_type?s("InputNumber",{staticStyle:{width:"180px"},attrs:{placeholder:"请输入金额"},model:{value:e.singleItem.money,callback:function(t){e.$set(e.singleItem,"money",t)},expression:"singleItem.money"}}):e._e(),e._v(" "),"add"!=e.modal_type?s("InputNumber",{staticStyle:{width:"180px"},attrs:{disabled:"",placeholder:"请输入金额"},model:{value:e.singleItem.money,callback:function(t){e.$set(e.singleItem,"money",t)},expression:"singleItem.money"}}):e._e()],1),e._v(" "),s("FormItem",{attrs:{label:"开卡人",prop:"created_by"}},[s("Select",{attrs:{placeholder:"请选择开卡人"},model:{value:e.singleItem.created_by,callback:function(t){e.$set(e.singleItem,"created_by",t)},expression:"singleItem.created_by"}},e._l(e.employee_list,function(t,a){return s("Option",{key:a,attrs:{value:t.value}},[e._v(e._s(t.label))])}))],1),e._v(" "),s("FormItem",[s("Button",{attrs:{type:"primary"},on:{click:function(t){e.handleSubmit("singleItem")}}},[e._v("提交")]),e._v(" "),s("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){e.handleReset("singleItem")}}},[e._v("重置")])],1)],1)],1)},staticRenderFns:[]},o=s("VU/8")(n,i,!1,null,null,null);t.a=o.exports}});
//# sourceMappingURL=6.7af2c67fb6867acd1e5c.js.map